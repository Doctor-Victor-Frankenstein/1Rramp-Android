language: android
sudo: required
jdk: oraclejdk8
before_cache:
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
# var
env:
  global:
  - ANDROID_API=27
  - EMULATOR_API=22
  - ANDROID_BUILD_TOOLS=27.1.1
  - ADB_INSTALL_TIMEOUT=5
  - secure: h51vBQ5GfZVq/gZYGvI4+f4JSAsDK6DIcbhbSGmtkmklj/llO/kgsqSnQ/Kp8igt7bu/gluMC9pjngIqb5eU651erPK1X8hNXVP4JvmAvJQfwoKGZ/uubBbfi0E8FlHhtHaVRs8JSLhM9MT85A/iqpFL8yOPiuzm1hLF1V5ORtU97miCugFhF4QwELod9/tU5f2GhqRjXKXw2MFms1NTYhGAmhgMB6+xuCX9kK1eavY9sZ7QPWRTm82QV26O38s6Q1h0yz7otwk8nL5SiufZ7KOzkv2VpHsz858A2LTl+kmAw5y2BfcXIW/4rAd7tkT5mRfqWw899h4YB4+CgQzEgoALMeR2y63SuWnDqbQL5noJhJLRi98m86vED4t59bTQ2fZkjdynxv9sUowXkHyRtBxRkB4Yn6HMBe8wSX4hSV3b9FMp7zOTEBu+JjC2muyeVsge1kM2ZVP5r42HV83hZRPAhMmuPfVgCi3rXefcQ270/CUV3kxw2ZBuAXiNjGxidfAOMbxb1CvWTgxcubE9Rv2qRBiZqMxI/5j5ULRsLwH0hsnOWNfNYpsBLPHyGTA2kGIS/RZ3lK00NYI2IrDIxeSs5j3opdE9835WmwONfNXQEwG0D7iVKZgZyjVK6YNYWLfzV8rNCRJn3FwDoSoJCiIyUVZyveMcyp11Q4gtLKI=
  - secure: s86TTwannpchi6DjNIKUyMTjbRufXvAqSp00/nbvFm2kG8Mn+o6wO2IYcLOFywCpJXaYa6Fq15zcFonlgeSZH9SJRiheLIjF2HsSEFuxcD3aiU/Nu+OQKTjpvLxUmMWu/BeVJQ5ilwsF7agKlc/gUlqKzLGs3cb/M4b9/wOONEfEtfAbSGjsVH2Tfe+b6BMSlENCZ9ABs3xE0NrCNxsUo9wyup9oYqqL+WmECCrjt7oVoRfiUOmN4rEVHIfTt4eBOeVzj7/Y8xqb6GnUZoFaVJ1nhwUv78fB/lUj8t4RWdYRTVJak6MsMmTNN69VfQYKKyJyGFfue2BldT7raEcvq/XvNTX9UhqMWRdYuZ9MvA8kCAehQhOBPBk1Y0VKTqJjI0aXH9g80WVAmwYHUNjlrmS7pIOyXKddBwl90tU62OBsRNKq9cT5dZdweoIuHyEYLlPEatF4l/hHV3IlEtLV0Pkq8mAKdSiqZ1qiDZZSOUrVviW76+BcLlIP57angoLZ7LbjI/FBvEWKkJDxZOSc6Ib6vJCzUbxu173DxdR9SLtY8QQCx4POC6oTDALix145l+y/uP+dYG9Dpi8Q+cV2U2ALdAdKW0m5ONknR0RoFBRcsE6RUFo4Z1/95Lbd2/bmxHTCyID5WsTR3ql35wLAUy9tsp0moxpFIX5ALfXZUYs=
android:
  components:
  - tools
  - platform-tools
  - build-tools-$ANDROID_BUILD_TOOLS
  - android-$ANDROID_API
  - android-22
  - sys-img-armeabi-v7a-android-22
  - android-$EMULATOR_API_LEVEL
  - extra-google-m2repository
  - extra-android-m2repository
  - addon-google_apis-google-19
  - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_API_LEVEL
  - sys-img-armeabi-v7a-addon-google_apis-google-$EMULATOR_API_LEVEL
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_install:
  - openssl aes-256-cbc -K $encrypted_f7d6497b3355_key -iv $encrypted_f7d6497b3355_iv -in hapramp.jks.enc -out hapramp.jks -d
  - mkdir "$ANDROID_HOME/licenses" || true
  - echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
  - echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
  - echo y | sdkmanager "platforms;android-27"
  - echo y | sdkmanager "build-tools;27.0.3"
  - chmod +x gradlew
  - "./gradlew dependencies || true"
before_script:
  - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
  - emulator -avd test -no-skin -no-audio -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &
script:
  - "./gradlew clean build connectedCheck -PdisablePreDex --stacktrace"
before_deploy:
  - cp $TRAVIS_BUILD_DIR/hapramp.jks $HOME
  - cd app/build/outputs/apk/
  - jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/hapramp.jks
    -storepass $storepass -keypass $keypass app-release-unsigned.apk ExampleKeystoreAlias
  - jarsigner -verify app-release-unsigned.apk
  - "${ANDROID_HOME}/build-tools/24.0.2/zipalign -v 4 app-release-unsigned.apk Hapramp.apk"
deploy:
  provider: releases
  file: Hapramp.apk
  skip_cleanup: true
  on:
    repo: hapramp/Hapramp-Android
    tags: true
    all_branches: true
    jdk: oraclejdk8
  api_key:
    secure: x5n3DxJFNZAPaCbPHDIAFdvp4veVrACqAdf+yYRjtZTMplVa0hnTYJS+clmW1bq0kUwHElTAtcmSrKp+fPfVRHLS6e6g/uIO/RgLYkcvUPsG/p9GfBCrGtKRQ2RLmTDcaMXdMHuy5rhqiIe7bk2vlG74zegtGAo5vlhhPjSrQrJCcsCRsTjIvo0TnoG0oibPXCLScNFKmQRJsr4PONKpsOJzqCz60Anb31BdlXEjP2Gm/nK7QEiEx8banjjWuWm34qWCmRXbvKgmyNzp0VKEMg7eJixQdud+sLiffXQ3H4xLhlawwIsKX8vavwGVwZ7I7mfEIhesy11xNAJn40airTarubCElWBjItLXl6tMImmcmXxGA19PJwYwMCqvmiok9BRqvBLCiTn9VgdmuLc5kv1t19WdVtXdXq/1lYo2hBFnk791CmAuEyBWaDjFtyhVm44L2YbUFBcnZ1laSPL9ng7pjaWD9iRow9V08OQI97/BCV442TeOllLNq5lpWVshQeSQCXKDtF0GLi2Ew0fxlKdbPun/Q5GJ2Rz20lAs7+yXpCLQqoGwLPAI4hMq0Jux5rjpN7YpQ6+DZhpBfYsMxHWxmkHaBiyb5mnCcMLU7yFBjGZs8dCECA/etQdwTcpxhermHO3ogxUaw7yM5s1puRA7245umbmeI9pFk1JnuaM=
